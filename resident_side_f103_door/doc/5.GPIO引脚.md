# GPIO引脚初始

## 1 什么是GPIO引脚

GPIO是General Purpose Input/Output（通用输入/输出）的缩写。它是一种在数字电路中常用的接口，用于与外部设备进行通信.

如下图, 就是设备内部和外部进行数字信号交互的一个电路脚
![](https://pic2.imgdb.cn/item/64636fb10d2dde5777fcfa4e.jpg)

芯片上的引脚
![](https://pic2.imgdb.cn/item/64645e0a0d2dde57774c1e98.jpg)

我们开发板上有很多元器件, 而cpu(soc)就是通过一个个的引脚来和板上的元器件进行信号交互的, 而通用IO的引脚就叫做GPIO引脚

## 2  数字电路的三种状态

1. 高电平 --1
1. 低电平 --0
2. 不确定 --无法测出电压值

我们知道计算机的逻辑就是0和1, 那他们是如何实现的呢, 就是高低电平

在数字电路中，一般规定低电平为0~1.3V，高电平为2.7V~5V。低电平表示逻辑0, 高电平表示1. 这个高低电平的电压在不同的电路系统上可能会不一样, 实际运行中,也很难做到一直都是完美的区间. 但是只要电压摆幅合理, 数字电路即可正确表示逻辑0和逻辑1.

## 3  芯片参考手册

[STM32F10X芯片参考手册](//TODO)中有关于GPIO引脚的详细描述,这里
只记录几个自己不太明白的, 来认识下电路

### 3.1 

![](https://pic2.imgdb.cn/item/646472dd0d2dde5777638d7e.jpg)

### 3.2 保护二极管

![](https://pic2.imgdb.cn/item/646472010d2dde577762adf1.jpg)

可以看到二极管的方向, 这样保证了了通过引脚输入输出芯片的电压一定是在
Vss ~ Vdd 之间

### 3.3 上拉 和 下拉电阻

![](https://pic2.imgdb.cn/item/646474230d2dde577764bcc9.jpg)

上拉输入（Pull-up Input）和下拉输入（Pull-down Input）是数字电路中用于输入引脚的电路配置，用于提供默认的电平状态和防止输入信号漂移的影响。

上拉输入是将输入引脚连接到正电压，以提供默认的高电平状态。这可以通过将一个上拉电阻连接到引脚和正电压之间来实现。当没有外部信号施加到引脚时，上拉电阻使引脚保持在高电平状态。

下拉输入是将输入引脚连接到地，以提供默认的低电平状态。这可以通过将一个下拉电阻连接到引脚和地之间来实现。当没有外部信号施加到引脚时，下拉电阻使引脚保持在低电平状态。

上拉输入和下拉输入的目的是确保输入引脚在没有外部信号施加时有一个明确定义的电平状态。这有助于防止输入信号的漂移和干扰，保持稳定的输入状态，并提供可靠的信号处理。

在实际应用中，选择使用上拉输入还是下拉输入取决于具体的设计需求和输入信号的特性。有些情况下，使用上拉输入更为常见，而在其他情况下，使用下拉输入更为适合。正确的选择能够确保输入信号的稳定性和可靠性，以满足电路的要求。


### 3.4 施密特触发器

![](https://pic2.imgdb.cn/item/6464736e0d2dde5777641afb.jpg)

施密特触发器（Schmitt Trigger）是一种具有双稳态特性的触发器电路，用于处理输入信号的噪声和抖动，以产生稳定的输出。它常用于数字电路中的信号处理和边沿检测。

施密特触发器的作用包括：

1. 消除输入信号的噪声：施密特触发器对于输入信号的噪声和干扰具有较高的抵抗能力。它通过设定两个阈值（上阈值和下阈值），只有当输入信号的幅度超过这些阈值时，输出才会切换。这样可以滤除输入信号中的噪声和干扰，使输出信号更加稳定。

2. 抑制输入信号的抖动：当输入信号存在抖动时，即在临界阈值范围内频繁切换，施密特触发器的双稳态特性可以抑制这种抖动。它会在输入信号超过上阈值时产生高电平输出，在输入信号低于下阈值时产生低电平输出，只有在输入信号超过另一个阈值才会切换输出状态，从而消除了输入信号的抖动。

3. 边沿检测：施密特触发器可以用于检测输入信号的边沿（上升沿或下降沿）。通过适当设置阈值，当输入信号从低电平切换到高电平或从高电平切换到低电平时，触发器的输出状态会发生变化，实现边沿检测功能。

总的来说，施密特触发器在数字电路中起到信号处理、噪声滤除和边沿检测的作用，提供了稳定的输出信号，对于提高信号质量和可靠性具有重要意义。

### 3.5 模拟输入和替代输入

![](https://pic2.imgdb.cn/item/646476270d2dde577767ed1a.jpg)

#### 3.5.1 模拟输入
模拟输入（Analog Input）是指在电子系统中接收模拟信号的输入端口或接口。模拟信号是连续变化的信号，可以采用不同的电压或电流值来表示。

模拟输入通常用于接收来自传感器、电压源、音频设备等模拟信号源的信号。这些信号可以是温度、压力、光强度、声音等物理量的变化，模拟输入端口将这些变化转换为数字信号以供系统处理。

在嵌入式系统和电子设备中，模拟输入通常需要经过模数转换（Analog-to-Digital Conversion，ADC）的过程，将模拟信号转换为数字信号，以便于数字系统进行处理和分析。

模拟输入在许多应用领域中起着重要的作用，例如传感器数据采集、音频处理、图像处理等。通过模拟输入，系统能够获取外部环境的信息，并进行相应的处理和响应。

#### 3.5.1 替代功能输入
Alternate Function Input（替代功能输入）是指在某些微控制器和芯片中，GPIO引脚可以配置为除了通常的输入/输出功能之外的其他功能。这些额外的功能可以是特定的外设功能，如UART通信、SPI通信、I2C通信、定时器输入等。

通过将GPIO引脚配置为Alternate Function Input模式，可以将其用作特定功能的输入接口。在此模式下，引脚将连接到对应的外设模块，以接收来自外设的信号。这样可以实现与外部设备的通信、数据传输或其他特定功能的操作。

配置GPIO引脚为Alternate Function Input通常涉及设置相关的寄存器或使用特定的开发工具和库函数。具体的配置方式和支持的功能取决于芯片或微控制器的型号和技术规格。

使用Alternate Function Input功能可以充分利用芯片的引脚资源，提供更多的灵活性和功能扩展能力，满足各种应用需求。在设计电路时，需要根据具体的应用需求和外设接口要求，选择合适的GPIO引脚配置为Alternate Function Input模式。

## 4. 输出

![](https://pic2.imgdb.cn/item/646476f10d2dde577769b150.jpg)

### 4.1 推挽输出

如图推挽输出模式下, 

当需要出高电平的时候, 输出控制器向P-MOS的Base极输出一个电压, P-MOS就处于导通状态, 这时候Vdd的高电平电压就输出到引脚. 

当需要出高电平的时候, 输出控制器向N-MOS的base极输出一个电压, 此时N-MOS就处于导通状态, 这时候Vss的低电平电压就输出到引脚.


### 4.2 开漏输出

开漏输出（Open-Drain Output）是一种数字电路输出结构，在该结构中，输出器件（通常是晶体管）只能将输出连接到地（低电平）或不连接（高阻态），而不能直接提供高电平输出。

当需要出高电平的时候, **输出控制器不输出电压** 此时N-MOS和P-MOS都属于断开状态(高阻态), 这个时候输出引脚的电压由外部确定. 相当于SOC没有输出任何信号. 

当需要出高电平的时候, 输出控制器向N-MOS的base极输出一个电压, 此时N-MOS就处于导通状态, 这时候Vss的低电平电压就输出到引脚.

**也就是说开漏输出模式下, P-MOS是不起任何作用的** 

开漏输出常用于驱动需要接受开漏输入的外部设备或总线，例如驱动I2C总线、驱动开关等。通过将多个开漏输出器件连接到同一信号线上，并使用上拉电阻将信号线拉高，可以实现多个设备之间的通信和共享。

### 4.3 两种输出方式的适用场景

开漏输出（Open-Drain Output）和推挽输出（Push-Pull Output）是两种常见的输出模式，它们在不同的应用场景下有不同的适用性。

开漏输出适用于以下场景：

1. 总线驱动：当需要驱动共享总线的设备时，开漏输出是一种常见的选择。多个设备可以连接到同一条总线上，并使用开漏输出器件将数据线拉低，而其他设备则可以将其输出设置为高阻态（高电平）。这种方式允许多个设备共享总线并避免冲突。s

2. 外部设备接口：当需要与外部设备进行连接时，例如与电平不兼容的器件、继电器、LED等，开漏输出可以提供电平转换和电流驱动能力。通过连接外部上拉电阻或外部电源，可以将开漏输出转换为正确的高电平。

推挽输出适用于以下场景：

1. 直接驱动负载：推挽输出可以直接驱动负载，例如LED、电机、继电器等。当输出为高电平时，输出器件提供电源电平；当输出为低电平时，输出器件提供地电平。这种方式可以提供较大的输出电流和较低的电压降。

2. 高速信号传输：推挽输出在输出电平切换时具有较快的切换速度，适用于高速信号传输或驱动高频率的负载。

需要注意的是，选择开漏输出还是推挽输出取决于具体的应用需求和连接设备的要求。在设计电路时，需要考虑输出电平、电流要求、连接的外部设备以及总线协议等因素来选择适当的输出模式。

### 4.4 复用推挽输出和复用开漏输出

多了一个复用的意义是在哪里呢

**不带复用的输出**表示-输出数据来源于**寄存器**

**带复用的输出**表示-输出的数据来源于`Alternate Function Output` 也就是来源于片上外设. 我们在[STM32简介]提到过片上外设的概念, STM32的芯片不仅有MCU, 还有一些如时钟,SPI通信模块等片上外设.
